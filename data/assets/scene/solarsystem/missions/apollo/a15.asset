local assetHelper = asset.require('util/asset_helper')
local sunTransforms = asset.require('scene/solarsystem/sun/transforms')
asset.require('spice/base')

local models = asset.syncedResource({
    Name = "Apollo 15 Models",
    Type = "HttpSynchronization",
    Identifier = "apollo_models",
    Version = 1
})

local kernels = asset.syncedResource({
    Name = "Apollo Kernels",
    Type = "HttpSynchronization",
    Identifier = "apollo_spice",
    Version = 1
})

local Kernels = {
    kernels .. "/apollo15.0001.tsc",  
    kernels .. '/apollo15.0001.tf',
    kernels .. '/apollo15MetricAddendum002.ti',
    kernels .. '/apollo15_metric.0002.ti',
    kernels .. '/apollo15-1.bsp',
    kernels .. '/AS15-M_v01.bc',
}


local Apollo15 = {
    Identifier = "Apollo15",
    Parent = "Moon",
    Transform = {
        Translation = {
            Type = "SpiceTranslation",
            Target = "APOLLO 15",
            Observer = "MOON",
            Frame = "IAU_MOON",
            Kernels = Kernels
        },
        Rotation = {
            Type = "SpiceRotation",
            SourceFrame = "A15_METRIC",
            DestinationFrame = "GALACTIC"
        }
    },
    TimeFrame = {
        Type = "TimeFrameInterval",
        Start = "1971-07-30T02:22:00.00",
        End = "1971-08-01T18:05:00.00"
    },
    GUI = {
        Name = "Apollo 15",
        Path = "/Solar System/Missions/Apollo 15"
    }
}

local Apollo15Main = {
    Identifier = "Apollo15Main",
    Parent = Apollo15.Identifier,
    Renderable = {
        Type = "RenderableModel",
        Geometry = {
            Type = "MultiModelGeometry",
--            GeometryFile = models .. "/Apollo_Spacecraft.obj"
            GeometryFile = models .. "/Apollo_CSM_shrunk_rotated_xy_doubble_size.obj"
        },
        ColorTexture = models .. "/gray.png",
        LightSources = assetHelper.getDefaultLightSources(sunTransforms.SolarSystemBarycenter.Identifier),
        DisableFaceCulling = true 
    },
    GUI = {
        Name = "Apollo 15 Main",
        Path = "/Solar System/Missions/Apollo 15"
    }   
}

local Apollo15Trail = {
    Identifier = "Apollo15Trail",
    Parent = "Moon",
    Renderable = {
        Type = "RenderableTrailTrajectory",
        Translation = {
            Type = "SpiceTranslation",
            Target = "APOLLO 15",
            Observer = "MOON",
            Frame = "IAU_MOON",
            Kernels = Kernels
        },
        Color = { 0.70, 0.50, 0.20 },
        StartTime = "1971 JUL 26",
        EndTime = "1971 AUG 01 14:30:41.680",
        SampleInterval = 2
    },
    GUI = {
        Name = "Apollo 15 Trail",
        Path = "/Solar System/Missions/Apollo 15"
    }
}

assetHelper.registerSceneGraphNodesAndExport(asset, {
    Apollo15,
    Apollo15Main,
    Apollo15Trail
})