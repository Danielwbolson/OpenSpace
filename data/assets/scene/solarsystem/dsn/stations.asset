local assetHelper = asset.require('util/asset_helper')
local sunTransforms = asset.require('scene/solarsystem/sun/transforms')
local earthTransforms = asset.require('scene/solarsystem/planets/earth/transforms')
local earthAsset = asset.require('scene/solarsystem/planets/earth/earth')

local sceneHelper = asset.require('util/scene_helper')
local propertyHelper = asset.require('util/property_helper')

local globeTranslation = asset.require('examples/globetranslation')


local models = asset.syncedResource({
    Name = "Dsn models",
    Type = "HttpSynchronization",
    Identifier = "dsn_stations",
    Version = 1
})

local LightSources = {
    {
        Type = "SceneGraphLightSource",
        Identifier = "Sun",
        Node = sunTransforms.SolarSystemBarycenter.Identifier,
        Intensity = 1.0
    },
    {
        Identifier = "Camera",
        Type = "CameraLightSource",
        Intensity = 0.5
    }
}

-- Colormap for the different sites
local siteColorMap = {  
                        GoldstoneColor = {0.0, 0.0, 1.0}, 
                        CanberraColor = {1.0, 0.0, 0.0}, 
                        MadridColor = {0.0, 1.0, 0.0} 
                      }

-- Map to the site locations above, this will determine the signal colors
local stationSiteMap = {
                 DSS14 = "GoldstoneColor",
                 DSS15 = "GoldstoneColor",
                 DSS24 = "GoldstoneColor",
                 DSS25 = "GoldstoneColor",
                 DSS26 = "GoldstoneColor",
                 DSS43 = "CanberraColor",
                 DSS34 = "CanberraColor",
                 DSS35 = "CanberraColor",
                 DSS36 = "CanberraColor",
                 DSS45 = "CanberraColor",
                 DSS63 = "MadridColor",
                 DSS65 = "MadridColor",
                 DSS54 = "MadridColor",
                 DSS55 = "MadridColor"
        }

--------------------- Goldstone ------------------------
local RotationMatrixGoldstone = {
-0.9740529,  0.1544376, -0.1654387,
  -0.2245064, -0.7517193,  0.6200927,
  -0.0285979,  0.6411452,  0.7668866 
}

local RotationMatrixCanberra = {
0.7544932,  0.2119603, -0.6211383,
  -0.6211383,  0.5362649, -0.5714955,
   0.2119603,  0.8170023,  0.5362649 
}

local RotationMatrixMadrid = {
 0.7257154,  0.1897224, -0.6613188,
   0.6879883, -0.1958808,  0.6987867,
   0.0030358, -0.9620999, -0.2726805
}

local DSS14 = {
    Identifier = "DSS14",
    Parent = earthAsset.Earth.Identifier,
    Transform =  {
    Translation = {
        Type = "GlobeTranslation",
        Globe = earthAsset.Earth.Identifier,
        Longitude = 243.11046,
        Latitude = 35.4259,
      }
   },
    Renderable = {
        Type = "RenderableModel",
        Geometry = {
            Type = "MultiModelGeometry",
            GeometryFile = models .. "/70m_dish/70m_dish.obj"
        },
        ColorTexture = models .. "/70m_dish/truss_dish_AO.jpg", 
        ModelTransform = RotationMatrixGoldstone

    },
    GUI = {
        Name = "DSS14",
        Path = "/Solar System/Stations/Goldstone"
    }
}

-- Retired?
local DSS15 = {
    Identifier = "DSS15",
    Parent = earthAsset.Earth.Identifier,
    Transform = {
 Translation = {
        Type = "GlobeTranslation",
        Globe = earthAsset.Earth.Identifier,
        Longitude = 243.11046379722,
        Latitude = 35.42590143888,
      }
   },
    Renderable = {
        Type = "RenderableModel",
        Geometry = {
            Type = "MultiModelGeometry",
            GeometryFile = models .. "/34m_dish/34m_dish.obj"
        },
        ColorTexture = models .. "/34m_dish/base_AO.png" ,
        ModelTransform = RotationMatrixGoldstone

    },
    GUI = {
        Name = "DSS15",
        Path = "/Solar System/Stations/Goldstone"
    }
}

local DSS24 = {
    Identifier = "DSS24",
    Parent = earthAsset.Earth.Identifier,
    Transform = {
     Translation = {
        Type = "GlobeTranslation",
        Globe = earthAsset.Earth.Identifier,
        Longitude = 243.12521,
        Latitude = 35.33989,
      }
   },
    Renderable = {
        Type = "RenderableModel",
        Geometry = {
            Type = "MultiModelGeometry",
            GeometryFile = models .. "/34m_dish/34m_dish.obj"
        },
        ColorTexture = models .. "/34m_dish/base_AO.png",
        ModelTransform = RotationMatrixGoldstone


    },
    GUI = {
        Name = "DSS24",
        Path = "/Solar System/Stations/Goldstone"
    }
}

local DSS25 = {
    Identifier = "DSS25",
    Parent = earthAsset.Earth.Identifier,
    Transform = {
     Translation = {
        Type = "GlobeTranslation",
        Globe = earthAsset.Earth.Identifier,
        Longitude = 243.12464,
        Latitude = 35.33761,
      }
   },
    Renderable = {
        Type = "RenderableModel",
        Geometry = {
            Type = "MultiModelGeometry",
            GeometryFile = models .. "/34m_dish/34m_dish.obj"
        },
        ColorTexture = models .. "/34m_dish/base_AO.png",
        ModelTransform = RotationMatrixGoldstone

    },
    GUI = {
        Name = "DSS25",
        Path = "/Solar System/Stations/Goldstone"
    }
}

local DSS26 = {
    Identifier = "DSS26",
    Parent = earthAsset.Earth.Identifier,
    Transform = {
      Translation = {
        Type = "GlobeTranslation",
        Globe = earthAsset.Earth.Identifier,
        Longitude = 243.12698,
        Latitude = 35.33569,
      }
   },
    Renderable = {
        Type = "RenderableModel",
        Geometry = {
            Type = "MultiModelGeometry",
            GeometryFile = models .. "/34m_dish/34m_dish.obj"
        },
        ColorTexture = models .. "/34m_dish/base_AO.png", 
        ModelTransform = RotationMatrixGoldstone

    },
    GUI = {
        Name = "DSS26",
        Path = "/Solar System/Stations/Goldstone"
    }
}


--------------------- Canberra ------------------------

local DSS43 = {
    Identifier = "DSS43",
    Parent = earthAsset.Earth.Identifier,
    Transform = {
     Translation = {
        Type = "GlobeTranslation",
        Globe = earthAsset.Earth.Identifier,
        Longitude = 148.98127,
        Latitude = -35.40242,
      }
   },
    Renderable = {
        Type = "RenderableModel",
        Geometry = {
            Type = "MultiModelGeometry",
            GeometryFile = models .. "/70m_dish/70m_dish.obj"
        },
        ColorTexture = models .. "/70m_dish/truss_dish_AO.jpg",
        ModelTransform = RotationMatrixCanberra

    },
    GUI = {
        Name = "DSS43",
        Path = "/Solar System/Stations/Canberra"
    }
}
 
local DSS34 = {
    Identifier = "DSS34",
    Parent = earthAsset.Earth.Identifier,
    Transform = {
      Translation = {
        Type = "GlobeTranslation",
        Globe = earthAsset.Earth.Identifier,
        Longitude = 148.98127,
        Latitude = -35.40242,
      }
   },
    Renderable = {
        Type = "RenderableModel",
        Geometry = {
            Type = "MultiModelGeometry",
            GeometryFile = models .. "/34m_dish/34m_dish.obj"
        },
        ColorTexture = models .. "/34m_dish/base_AO.png",
        ModelTransform = RotationMatrixCanberra

    },
    GUI = {
        Name = "DSS34",
        Path = "/Solar System/Stations/Canberra"
    }
}

local DSS35 = {
    Identifier = "DSS35",
    Parent = earthAsset.Earth.Identifier,
    Transform = {
       Translation = {
        Type = "GlobeTranslation",
        Globe = earthAsset.Earth.Identifier,
        Longitude = 148.98146,
        Latitude = -35.3958,
      }
   },
    Renderable = {
        Type = "RenderableModel",
        Geometry = {
            Type = "MultiModelGeometry",
            GeometryFile = models .. "/34m_dish/34m_dish.obj"
        },
        ColorTexture = models .. "/34m_dish/base_AO.png",
        ModelTransform = RotationMatrixCanberra

    },
    GUI = {
        Name = "DSS35",
        Path = "/Solar System/Stations/Canberra"
    }
}

local DSS36 = {
    Identifier = "DSS36",
    Parent = earthAsset.Earth.Identifier,
    Transform = {
       Translation = {
        Type = "GlobeTranslation",
        Globe = earthAsset.Earth.Identifier,
        Longitude = 148.97854,
        Latitude = -35.39511,
      }
   },
    Renderable = {
        Type = "RenderableModel",
        Geometry = {
            Type = "MultiModelGeometry",
            GeometryFile = models .. "/34m_dish/34m_dish.obj"
        },
        ColorTexture = models .. "/34m_dish/base_AO.png",
        ModelTransform = RotationMatrixCanberra

    },
    GUI = {
        Name = "DSS36",
        Path = "/Solar System/Stations/Canberra"
    }
}

-- Retired 2016
local DSS45 = {
    Identifier = "DSS45",
    Parent = earthAsset.Earth.Identifier,
    Transform = {
       Translation = {
        Type = "GlobeTranslation",
        Globe = earthAsset.Earth.Identifier,
        Longitude = 148.97768,
        Latitude = -35.39846,
      }
   },
    Renderable = {
        Type = "RenderableModel",
        Geometry = {
            Type = "MultiModelGeometry",
            GeometryFile = models .. "/34m_dish/34m_dish.obj"
        },
        ColorTexture = models .. "/34m_dish/base_AO.png",
        ModelTransform = RotationMatrixCanberra

    },
    GUI = {
        Name = "DSS45",
        Path = "/Solar System/Stations/Canberra"
    }
}


--------------------- Madrid ------------------------

local DSS63 = {
    Identifier = "DSS63",
    Parent = earthAsset.Earth.Identifier,
    Transform = {
      Translation = {
        Type = "GlobeTranslation",
        Globe = earthAsset.Earth.Identifier,
        Longitude = 355.75199,
        Latitude = 40.43121,
      }
   },
    Renderable = {
        Type = "RenderableModel",
        Geometry = {
            Type = "MultiModelGeometry",
            GeometryFile = models .. "/70m_dish/70m_dish.obj"
        },
        ColorTexture = models .. "/70m_dish/truss_dish_AO.jpg",
        ModelTransform = RotationMatrixMadrid

    },
    GUI = {
        Name = "DSS63",
        Path = "/Solar System/Stations/Madrid"
    }
}

local DSS65 = {
    Identifier = "DSS65",
    Parent = earthAsset.Earth.Identifier,
    Transform = {
      Translation = {
        Type = "GlobeTranslation",
        Globe = earthAsset.Earth.Identifier,
        Longitude = 355.7493,
        Latitude = 40.42721,
      }
   },
    Renderable = {
        Type = "RenderableModel",
        Geometry = {
            Type = "MultiModelGeometry",
            GeometryFile = models .. "/34m_dish/34m_dish.obj"
        },
        ColorTexture = models .. "/34m_dish/base_AO.png",
        ModelTransform = RotationMatrixMadrid

    },
    GUI = {
        Name = "DSS65",
        Path = "/Solar System/Stations/Madrid"
    }
}

local DSS54 = {
    Identifier = "DSS54",
    Parent = earthAsset.Earth.Identifier,
    Transform = {
       Translation = {
        Type = "GlobeTranslation",
        Globe = earthAsset.Earth.Identifier,
        Longitude = 355.7459,
        Latitude = 40.42562,
      }
   },
    Renderable = {
        Type = "RenderableModel",
        Geometry = {
            Type = "MultiModelGeometry",
            GeometryFile = models .. "/34m_dish/34m_dish.obj"
        },
        ColorTexture = models .. "/34m_dish/base_AO.png",
        ModelTransform = RotationMatrixMadrid

    },
    GUI = {
        Name = "DSS54",
        Path = "/Solar System/Stations/Madrid"
    }
}

local DSS55 = {
    Identifier = "DSS55",
    Parent = earthAsset.Earth.Identifier,
    Transform = {
       Translation = {
        Type = "GlobeTranslation",
        Globe = earthAsset.Earth.Identifier,
        Longitude = 355.74737,
        Latitude = 40.4243,
      }
   },
    Renderable = {
        Type = "RenderableModel",
        Geometry = {
            Type = "MultiModelGeometry",
            GeometryFile = models .. "/34m_dish/34m_dish.obj"
        },
        ColorTexture = models .. "/34m_dish/base_AO.png",
        ModelTransform = RotationMatrixMadrid

    },
    GUI = {
        Name = "DSS55",
        Path = "/Solar System/Stations/Madrid"
    }
}

assetHelper.registerSceneGraphNodesAndExport(asset, {
    DSS14, DSS15, DSS24, DSS25, DSS26, DSS43, DSS34, DSS35, DSS36, DSS45, DSS63, DSS65, DSS54, DSS55
})

asset.export("siteColorMap", siteColorMap)
asset.export("stationSiteMap", stationSiteMap)